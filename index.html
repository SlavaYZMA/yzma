<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Квантовые портреты</title>
    <link rel="stylesheet" href="./css/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/p5.min.js"></script>
    <script src="./js/main.js"></script>
    <script src="./js/particles.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>Квантовые портреты</h1>
            <p>Минова А.Н. | Art & Science</p>
        </header>
        <main>
            <section id="intro" class="step active">
                <div class="text-block">Пожалуйста, выберите язык: <button onclick="setLanguageAndNext('ru')">RU</button> / <button onclick="setLanguageAndNext('en')">ENG</button></div>
            </section>
            <section id="upload" class="step">
                <div class="text-block">Загрузите изображение для квантового портрета</div>
                <input type="file" id="uploadImage" accept="image/*" onchange="loadImage(event)">
                <button onclick="showArchive()">Выбрать из архива</button>
            </section>
            <section id="animation" class="step">
                <div id="portrait-container"></div>
                <div class="text-block">Двигайте курсор для коллапса суперпозиции</div>
                <button onclick="savePortrait()">Сохранить</button>
            </section>
            <section id="result" class="step">
                <div class="text-block">Ваш квантовый портрет сохранён</div>
                <img id="saved-portrait" style="display:none;">
                <button onclick="shareObservation()">Поделиться</button>
                <button onclick="restart()">Начать заново</button>
            </section>
        </main>
        <footer>
            <button id="about">Об авторах</button>
        </footer>
    </div>

    <script>
        window.quantumSketch = new p5(function(sketch) {
            sketch.setup = function() {
                sketch.createCanvas(600, 600).parent('portrait-container');
                sketch.background(20);
                sketch.noLoop();
            };

            sketch.draw = function() {
                sketch.background(20);
                if (window.particles) window.updateParticles(sketch);
            };

            sketch.mouseMoved = function() { if (window.currentStep === 2) window.observeParticles(sketch, sketch.mouseX, sketch.mouseY); };
        });

        function loadImage(event) {
            const file = event.target.files[0];
            if (file) {
                window.quantumSketch.loadImage(URL.createObjectURL(file), img => {
                    window.img = img;
                    window.initializeParticles(img);
                    window.moveToNextStep(2);
                });
            }
        }

        function showArchive() {
            alert('Архив в разработке — скоро будет доступен!');
            // Здесь можно добавить модальное окно с архивом позже
        }

        function savePortrait() {
            if (window.quantumSketch) {
                window.quantumSketch.saveCanvas('quantum_portrait', 'png');
                window.moveToNextStep(3);
            }
        }

        function shareObservation() {
            window.open('https://t.me/quantum_portrait_channel', '_blank');
            window.moveToNextStep(3);
        }

        function restart() {
            window.location.reload();
        }

        document.getElementById('about').addEventListener('click', () => {
            window.location.href = './about.html';
        });
    </script>
</body>
</html>
